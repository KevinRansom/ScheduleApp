<Window x:Class="ScheduleApp.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:conv="clr-namespace:ScheduleApp.Converters"
        xmlns:sys="clr-namespace:System;assembly=mscorlib"
        xmlns:beh="clr-namespace:ScheduleApp.Behaviors"
        xmlns:scm="clr-namespace:System.ComponentModel;assembly=WindowsBase"
        mc:Ignorable="d"
        Title="Support Coverage Scheduler"
        Height="600"
        Width="1200"
        UseLayoutRounding="True"
        SnapsToDevicePixels="True"
        WindowStyle="None"
        ResizeMode="CanResize"
        AllowsTransparency="True"
        Background="Transparent">
  <Window.Resources>
    <!-- Converters and non-appearance resources -->
    <conv:HeaderCornerRadiusConverter x:Key="HeaderCornerRadiusConverter"/>
    <conv:HeaderBorderThicknessConverter x:Key="HeaderBorderThicknessConverter"/>
    <conv:RoundedClipConverter x:Key="RoundedClipConverter"/>

    <conv:TimeSpanToStringConverter x:Key="TimeSpanToStringConverter" />
    <conv:TaskKindToBrushConverter x:Key="TaskKindToBrushConverter"
                                   CoverageBrush="{StaticResource BrushCoverage}"
                                   BreakBrush="{StaticResource BrushBreak}"
                                   LunchBrush="{StaticResource BrushLunch}"
                                   IdleBrush="{StaticResource BrushIdle}"/>
    <BooleanToVisibilityConverter x:Key="BoolToVis"/>
    <conv:InverseBooleanToVisibilityConverter x:Key="BoolToVisInverse"/>
    <conv:NotNullToTrueConverter x:Key="NotNullToTrue"/>
    <conv:NotNullToFalseConverter x:Key="NotNullToFalse"/>

    <!-- Time item template -->
    <DataTemplate x:Key="TimeItemTemplate">
      <TextBlock Text="{Binding Converter={StaticResource TimeSpanToStringConverter}}"
                 Style="{StaticResource DefaultTextElementStyle}" />
    </DataTemplate>
    <conv:SupportTeacherDisplayConverter x:Key="SupportTeacherDisplayConverter"/>

    <!-- Default sort: Support view by Start (DateTime) -->
    <CollectionViewSource x:Key="SupportRowsView" Source="{Binding Schedule.SelectedSupportRows}">
      <CollectionViewSource.SortDescriptions>
        <scm:SortDescription PropertyName="Start" Direction="Ascending"/>
      </CollectionViewSource.SortDescriptions>
    </CollectionViewSource>

    <!-- Default sort: Teacher view by SortKey (DateTime) -->
    <CollectionViewSource x:Key="TeacherRowsView" Source="{Binding Schedule.SelectedTeacherRows}">
      <CollectionViewSource.SortDescriptions>
        <scm:SortDescription PropertyName="SortKey" Direction="Ascending"/>
      </CollectionViewSource.SortDescriptions>
    </CollectionViewSource>
  </Window.Resources>

  <Grid>
    <DockPanel LastChildFill="True">
      <!-- Top-aligned navy title bar with hamburger -->
      <Border DockPanel.Dock="Top"
              CornerRadius="{StaticResource TopBarCornerRadius}"
              Background="{StaticResource TitleBarBackgroundBrush}"
              BorderBrush="{StaticResource TitleBarBorderBrush}"
              BorderThickness="{StaticResource GridOuterBorderThickness}"
              Padding="{StaticResource TopBarPadding}"
              SnapsToDevicePixels="True"
              Margin="{StaticResource TopBarOuterMargin}"
              MinHeight="{StaticResource TopBarMinHeight}"
              MouseLeftButtonDown="TitleBar_MouseLeftButtonDown">
        <Grid>
          <Grid.ColumnDefinitions>
            <ColumnDefinition Width="Auto"/>
            <ColumnDefinition Width="*"/>
            <ColumnDefinition Width="Auto"/>
          </Grid.ColumnDefinitions>

          <ToggleButton x:Name="HamburgerToggle"
                        Grid.Column="0"
                        Style="{StaticResource HamburgerToggleButtonStyle}"/>

          <TextBlock Grid.Column="1"
                     Text="Coverage Schedule App"
                     VerticalAlignment="Center"
                     HorizontalAlignment="Left"
                     Margin="8,0,0,0"
                     Foreground="{StaticResource TitleBarForegroundBrush}"
                     FontSize="16"
                     FontWeight="SemiBold"
                     IsHitTestVisible="False"/>

          <Popup x:Name="HamburgerPopup"
                 PlacementTarget="{Binding ElementName=HamburgerToggle}"
                 Placement="Bottom"
                 AllowsTransparency="True"
                 StaysOpen="False"
                 IsOpen="{Binding IsChecked, ElementName=HamburgerToggle, Mode=TwoWay}"
                 Closed="HamburgerPopup_Closed">
            <Border CornerRadius="{StaticResource PopupCornerRadius}"
                    Background="{StaticResource MenuBackgroundBrush}"
                    BorderBrush="{StaticResource MenuBorderBrush}"
                    BorderThickness="{StaticResource GridOuterBorderThickness}"
                    Padding="{StaticResource PopupPadding}"
                    SnapsToDevicePixels="True"
                    Margin="{StaticResource PopupMargin}"
                    Effect="{StaticResource PopupShadowEffect}"
                    MinWidth="200">
              <StackPanel Orientation="Vertical">
                <Button Style="{StaticResource MenuPopupButton}" Margin="{StaticResource PopupMenuItemMargin}" Click="MenuSchedule_Click" Content="Schedule"/>
                <Button Style="{StaticResource MenuPopupButton}" Margin="{StaticResource PopupMenuItemMargin}" Click="MenuPreview_Click" Content="Preview"/>
                <Button Style="{StaticResource MenuPopupButton}" Margin="{StaticResource PopupMenuItemMargin}" Click="MenuTeachers_Click" Content="Team Lineup"/>
                <Button Style="{StaticResource MenuPopupButton}" Margin="{StaticResource PopupMenuItemMargin}" Click="MenuPreferences_Click" Content="Preferences"/>
                <Button Style="{StaticResource MenuPopupButton}" Margin="{StaticResource PopupMenuItemMargin}" Click="MenuAlgorithm_Click" Content="Algorithm"/>
                <Button Style="{StaticResource MenuPopupButton}" Margin="{StaticResource PopupMenuItemMargin}" Click="MenuExit_Click" Content="Exit"/>
                <Separator Margin="{StaticResource PopupSeparatorMargin}"/>
                <Button Style="{StaticResource MenuPopupButton}" Click="AboutMenu_Click" Content="About"/>
              </StackPanel>
            </Border>
          </Popup>

          <StackPanel Grid.Column="2" Orientation="Horizontal" HorizontalAlignment="Right" VerticalAlignment="Center">
            <TextBlock Text="Saving…"
                       Margin="0,0,8,0"
                       VerticalAlignment="Center"
                       Foreground="{StaticResource TitleBarForegroundBrush}"
                       FontStyle="Italic"
                       FontSize="12"
                       Visibility="{Binding IsAutoSaving, Converter={StaticResource BoolToVis}}"
                       IsHitTestVisible="False"/>
            <Button x:Name="MinimizeButton"
                    Style="{StaticResource TitleBarMinimizeButtonStyle}"
                    Click="Minimize_Click"
                    ToolTip="Minimize" />

            <Button x:Name="MaximizeButton"
                    Style="{StaticResource TitleBarMaximizeButtonStyle}"
                    Click="MaximizeRestore_Click"
                    ToolTip="Maximize" />

            <Button x:Name="CloseButton"
                    Style="{StaticResource TitleBarCloseButtonStyle}"
                    Click="Close_Click"
                    ToolTip="Close" />
          </StackPanel>
        </Grid>
      </Border>

      <Border DockPanel.Dock="Top"
              CornerRadius="{StaticResource AppPaneCornerRadius}"
              Background="{StaticResource PrimaryBackgroundBrush}"
              BorderBrush="{StaticResource PrimaryBorderBrush}"
              BorderThickness="{StaticResource GridOuterBorderThickness}"
              SnapsToDevicePixels="True"
              Margin="{StaticResource AppPaneOuterMargin}"
              Padding="{StaticResource WindowContentPadding}">
        <Grid>
          <TabControl x:Name="MainTabControl"
                      SelectedIndex="{Binding SelectedTabIndex, Mode=TwoWay}"
                      SelectionChanged="MainTabControl_SelectionChanged">

            <!-- 1) Schedule -->
            <TabItem Header="Schedule">
              <Grid Margin="{StaticResource PageSectionMarginLarge}">
                <Grid.RowDefinitions>
                  <RowDefinition Height="Auto"/>
                  <RowDefinition Height="Auto"/>
                  <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <!-- Title row with relocated Print / Export buttons -->
                <Grid Grid.Row="1" Margin="{StaticResource ToolbarRowBottomMarginSmall}">
                  <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                  </Grid.ColumnDefinitions>

                  <!-- Title -->
                  <TextBlock Grid.Column="0"
                             Text="Schedule"
                             FontFamily="{StaticResource BodyFontFamily}"
                             FontSize="{StaticResource PageTitleFontSize}"
                             FontWeight="Normal"
                             Foreground="{StaticResource PrimaryTextBrush}"
                             HorizontalAlignment="Left"
                             Margin="{StaticResource TitleMarginBottomLarge}"/>

                  <!-- Filler (keeps right stack aligned to container width) -->
                  <Border Grid.Column="1" Background="Transparent"/>
                </Grid>

                <!-- Main inner content -->
                <ContentControl Grid.Row="2"
                                BorderThickness="0"
                                Style="{StaticResource RoundedTableContainer}"
                                Margin="{StaticResource NoMarginThickness}"
                                VerticalContentAlignment="Stretch">
                  <TabControl x:Name="ScheduleViewInnerTabControl"
                              Margin="{StaticResource NoMarginThickness}"
                              SelectionChanged="ScheduleViewInnerTabControl_SelectionChanged">
                    <TabItem Header="By Support">
                      <Grid Margin="16">
                        <Grid.ColumnDefinitions>
                          <ColumnDefinition Width="260"/>
                          <ColumnDefinition Width="16"/>
                          <ColumnDefinition Width="*"/>
                          <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>

                        <Border Grid.Column="0" Style="{StaticResource RoundedTableBorder}" Margin="{StaticResource NoMarginThickness}">
                          <ListBox x:Name="SupportListBox"
                                   beh:AutoSelectFirstBehavior.EnableAutoSelect="True"
                                   ItemsSource="{Binding Schedule.SupportEntries}"
                                   SelectionMode="Extended"
                                   SelectionChanged="SupportListBox_SelectionChanged"
                                   ScrollViewer.VerticalScrollBarVisibility="Auto"
                                   Background="{StaticResource TransparentBrush}"
                                   BorderThickness="0"
                                   IsSynchronizedWithCurrentItem="False"
                                   ItemContainerStyle="{StaticResource RoundedListBoxItemStyle}">
                            <ListBox.ItemTemplate>
                              <DataTemplate>
                                <Grid Margin="{StaticResource CellElementMargin}">
                                  <TextBlock Text="{Binding Name}" FontWeight="SemiBold" VerticalAlignment="Center">
                                    <TextBlock.Style>
                                      <Style TargetType="TextBlock">
                                        <Setter Property="Foreground" Value="{StaticResource PrimaryTextBrush}"/>
                                        <Setter Property="FontStyle" Value="Normal"/>
                                        <Style.Triggers>
                                          <DataTrigger Binding="{Binding IsUnscheduled}" Value="True">
                                            <Setter Property="Foreground" Value="{StaticResource SecondaryTextBrush}"/>
                                            <Setter Property="FontStyle" Value="Italic"/>
                                          </DataTrigger>
                                        </Style.Triggers>
                                      </Style>
                                    </TextBlock.Style>
                                  </TextBlock>
                                </Grid>
                              </DataTemplate>
                            </ListBox.ItemTemplate>
                          </ListBox>
                        </Border>

                        <Border Grid.Column="2" Style="{StaticResource RoundedTableBorder}" Margin="{StaticResource NoMarginThickness}">
                          <DataGrid x:Name="SupportDataGrid"
                                    ItemsSource="{Binding Source={StaticResource SupportRowsView}}"
                                    AutoGenerateColumns="False"
                                    CanUserAddRows="False"
                                    CanUserDeleteRows="False"
                                    IsReadOnly="True"
                                    HeadersVisibility="Column"
                                    GridLinesVisibility="Horizontal"
                                    HorizontalGridLinesBrush="{StaticResource SchedGridLineBrush}"
                                    ColumnHeaderStyle="{StaticResource RoundedDataGridColumnHeader}"
                                    CellStyle="{StaticResource DefaultCellStyle}"
                                    BorderThickness="{StaticResource NoBorderThickness}"
                                    Background="{StaticResource TransparentBrush}"
                                    SnapsToDevicePixels="True"
                                    Margin="{StaticResource NoMarginThickness}"
                                    Focusable="True"
                                    PreviewMouseLeftButtonDown="ScheduleArea_PreviewMouseLeftButtonDown">
                            <DataGrid.RowStyle>
                              <Style TargetType="DataGridRow">
                                <Setter Property="Background"
                                        Value="{Binding Kind, Converter={StaticResource TaskKindToBrushConverter},
                                                        FallbackValue={StaticResource TransparentBrush},
                                                        TargetNullValue={StaticResource TransparentBrush}}"/>
                                <Setter Property="SnapsToDevicePixels" Value="True"/>
                              </Style>
                            </DataGrid.RowStyle>

                            <DataGrid.Columns>
                              <DataGridTextColumn Header="Start Time" Binding="{Binding StartText}" Width="*"
                                                  CellStyle="{StaticResource DefaultCellStyle}"/>
                              <DataGridTextColumn Header="Support Staff" Binding="{Binding SupportName}" Width="2*"
                                                  CellStyle="{StaticResource DefaultCellStyle}"/>
                              <DataGridTextColumn Header="Teacher" Binding="{Binding ., Converter={StaticResource SupportTeacherDisplayConverter}}" Width="2*"
                                                  CellStyle="{StaticResource DefaultCellStyle}"/>
                              <DataGridTextColumn Header="Activity" Binding="{Binding TaskName}" Width="*"
                                                  CellStyle="{StaticResource DefaultCellStyle}"/>
                              <DataGridTextColumn Header="Duration" Binding="{Binding DurationText}" Width="*"
                                                  CellStyle="{StaticResource LastColumnCellStyle}"/>
                            </DataGrid.Columns>
                          </DataGrid>
                        </Border>

                        <!-- Right side panel: key only (buttons moved up) -->
                        <StackPanel Grid.Column="3"
                                    Orientation="Vertical"
                                    Margin="{StaticResource SidePanelLeftMargin}"
                                    VerticalAlignment="Top">
                          <StackPanel.Resources>
                            <!-- Reusable bordered pill just for the key -->
                            <Style x:Key="KeyPillStyle"
                                   TargetType="Border"
                                   BasedOn="{StaticResource PillStyle}">
                              <Setter Property="BorderThickness" Value="1"/>
                              <Setter Property="BorderBrush" Value="{StaticResource PrimaryBorderBrush}"/>
                            </Style>
                          </StackPanel.Resources>

                          <!-- Actions (moved out of inner tabs) -->
                          <Grid Grid.Column="0"
                                HorizontalAlignment="Stretch"
                                VerticalAlignment="Top"
                                Margin="0,0,0,0">
                            <Grid.RowDefinitions>
                              <RowDefinition />
                              <RowDefinition />
                              <RowDefinition /> <!-- added row for Preview button -->
                            </Grid.RowDefinitions>

                            <Button Grid.Row="0"
                                    Content="Print All"
                                    Style="{StaticResource RoundedActionButton}"
                                    Margin="0,0,0,4"
                                    HorizontalAlignment="Stretch"
                                    Command="{Binding PrintPreview.PrintAllCommand}"/>

                            <!-- New: show Preview inner tab -->
                            <Button Grid.Row="1"
                                    Content="Preview"
                                    Style="{StaticResource RoundedActionButton}"
                                    Margin="0,10,0,4"
                                    HorizontalAlignment="Stretch"
                                    Click="SchedulePreview_Click"/>

                            <Button Grid.Row="2"
                                    Content="Export PDF"
                                    Style="{StaticResource RoundedActionButton}"
                                    Margin="0,10,0,4"
                                    HorizontalAlignment="Stretch"
                                    Command="{Binding PrintPreview.ExportPdfCommand}"/>
                          </Grid>

                          <!-- Centered Key label -->
                          <TextBlock Text="Key"
                                     Margin="0,18,0,4"
                                     Foreground="{StaticResource SecondaryTextBrush}"
                                     FontWeight="SemiBold"
                                     HorizontalAlignment="Center"
                                     TextAlignment="Center"/>

                          <!-- New separator line -->
                          <Border Height="1"
                                  Margin="0,0,0,12"
                                  Background="{StaticResource SchedGridLineBrush}"
                                  HorizontalAlignment="Stretch"
                                  SnapsToDevicePixels="True"/>

                          <Border Background="{StaticResource BrushCoverage}" Style="{StaticResource KeyPillStyle}" Margin="0,0,0,8">
                            <TextBlock Text="Coverage" TextAlignment="Center" HorizontalAlignment="Stretch"/>
                          </Border>
                          <Border Background="{StaticResource BrushBreak}" Style="{StaticResource KeyPillStyle}" Margin="0,0,0,8">
                            <TextBlock Text="Break (10m + 5m buffer)" TextAlignment="Center" HorizontalAlignment="Stretch"/>
                          </Border>
                          <Border Background="{StaticResource BrushLunch}" Style="{StaticResource KeyPillStyle}" Margin="0,0,0,8">
                            <TextBlock Text="Lunch (30m)" TextAlignment="Center" HorizontalAlignment="Stretch"/>
                          </Border>
                          <Border Background="{StaticResource BrushIdle}" Style="{StaticResource KeyPillStyle}" Margin="0,0,0,8">
                            <TextBlock Text="Free" TextAlignment="Center" HorizontalAlignment="Stretch"/>
                          </Border>
                          <Border Background="{StaticResource BrushUnscheduled}" Style="{StaticResource KeyPillStyle}">
                            <TextBlock Text="Unscheduled" TextAlignment="Center" HorizontalAlignment="Stretch"/>
                          </Border>
                        </StackPanel>
                      </Grid>
                    </TabItem>

                    <TabItem Header="By Teacher">
                      <Grid Margin="16">
                        <Grid.ColumnDefinitions>
                          <ColumnDefinition Width="260"/>
                          <ColumnDefinition Width="16"/>
                          <ColumnDefinition Width="*"/>
                          <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>

                        <Border Grid.Column="0" Style="{StaticResource RoundedTableBorder}" Margin="{StaticResource NoMarginThickness}">
                          <ListBox x:Name="TeacherListBox"
                                   beh:AutoSelectFirstBehavior.EnableAutoSelect="True"
                                   ItemsSource="{Binding Setup.Teachers}"
                                   SelectionMode="Extended"
                                   SelectedItem="{Binding Schedule.SelectedTeacher, Mode=TwoWay}"
                                   SelectionChanged="TeacherListBox_SelectionChanged"
                                   ScrollViewer.VerticalScrollBarVisibility="Auto"
                                   Background="{StaticResource TransparentBrush}"
                                   BorderThickness="0"
                                   IsSynchronizedWithCurrentItem="False"
                                   ItemContainerStyle="{StaticResource RoundedListBoxItemStyle}">
                            <ListBox.ItemTemplate>
                              <DataTemplate>
                                <Grid Margin="{StaticResource CellElementMargin}">
                                  <TextBlock Text="{Binding Name}"
                                             FontWeight="SemiBold"
                                             VerticalAlignment="Center"
                                             Margin="8,0,0,0"/>
                                </Grid>
                              </DataTemplate>
                            </ListBox.ItemTemplate>
                          </ListBox>
                        </Border>

                        <Border Grid.Column="2" Style="{StaticResource RoundedTableBorder}" Margin="{StaticResource NoMarginThickness}">
                          <DataGrid x:Name="TeacherDataGrid"
                                    ItemsSource="{Binding Source={StaticResource TeacherRowsView}}"
                                    AutoGenerateColumns="False"
                                    CanUserAddRows="False"
                                    CanUserDeleteRows="False"
                                    IsReadOnly="True"
                                    HeadersVisibility="Column"
                                    GridLinesVisibility="Horizontal"
                                    HorizontalGridLinesBrush="{StaticResource SchedGridLineBrush}"
                                    ColumnHeaderStyle="{StaticResource RoundedDataGridColumnHeader}"
                                    CellStyle="{StaticResource DefaultCellStyle}"
                                    BorderThickness="{StaticResource NoBorderThickness}"
                                    Background="{StaticResource TransparentBrush}"
                                    SnapsToDevicePixels="True"
                                    Margin="{StaticResource NoMarginThickness}"
                                    Focusable="True"
                                    PreviewMouseLeftButtonDown="ScheduleArea_PreviewMouseLeftButtonDown">
                            <DataGrid.RowStyle>
                              <Style TargetType="DataGridRow">
                                <Setter Property="Background" Value="{Binding Converter={StaticResource TeacherRowToBrushConverter}}"/>
                                <Setter Property="SnapsToDevicePixels" Value="True"/>
                              </Style>
                            </DataGrid.RowStyle>

                            <DataGrid.Columns>
                              <DataGridTextColumn Header="Start Time" Binding="{Binding Start}" Width="*"
                                                  CellStyle="{StaticResource DefaultCellStyle}"/>
                              <DataGridTextColumn Header="Name" Binding="{Binding TeacherName}" Width="2*"
                                                  CellStyle="{StaticResource DefaultCellStyle}"/>
                              <DataGridTextColumn Header="Support Staff" Binding="{Binding SupportStaff}" Width="2*"
                                                  CellStyle="{StaticResource DefaultCellStyle}"/>
                              <DataGridTextColumn Header="Activity" Binding="{Binding Activity}" Width="*"
                                                  CellStyle="{StaticResource DefaultCellStyle}"/>
                              <DataGridTextColumn Header="Duration" Binding="{Binding Duration}" Width="*"
                                                  CellStyle="{StaticResource LastColumnCellStyle}"/>
                            </DataGrid.Columns>
                          </DataGrid>
                        </Border>

                        <!-- Right side panel: key only -->
                        <StackPanel Grid.Column="3"
                                    Orientation="Vertical"
                                    Margin="{StaticResource SidePanelLeftMargin}"
                                    VerticalAlignment="Top">
                          <StackPanel.Resources>
                            <!-- Reuse same bordered pill style -->
                            <Style x:Key="KeyPillStyle"
                                   TargetType="Border"
                                   BasedOn="{StaticResource PillStyle}">
                              <Setter Property="BorderThickness" Value="1"/>
                              <Setter Property="BorderBrush" Value="{StaticResource PrimaryBorderBrush}"/>
                            </Style>
                          </StackPanel.Resources>

                          <!-- Actions (moved out of inner tabs) -->
                          <Grid Grid.Column="0"
                                HorizontalAlignment="Stretch"
                                VerticalAlignment="Top"
                                Margin="0,0,0,0">
                            <Grid.RowDefinitions>
                              <RowDefinition />
                              <RowDefinition />
                              <RowDefinition /> <!-- added row for Preview button -->
                            </Grid.RowDefinitions>

                            <Button Grid.Row="0"
                                    Content="Print All"
                                    Style="{StaticResource RoundedActionButton}"
                                    Margin="0,0,0,4"
                                    HorizontalAlignment="Stretch"
                                    Command="{Binding PrintPreview.PrintAllCommand}"/>

                            <!-- New: show Preview inner tab -->
                            <Button Grid.Row="1"
                                    Content="Preview"
                                    Style="{StaticResource RoundedActionButton}"
                                    Margin="0,10,0,4"
                                    HorizontalAlignment="Stretch"
                                    Click="SchedulePreview_Click"/>

                            <Button Grid.Row="2"
                                    Content="Export PDF"
                                    Style="{StaticResource RoundedActionButton}"
                                    Margin="0,10,0,4"
                                    HorizontalAlignment="Stretch"
                                    Command="{Binding PrintPreview.ExportPdfCommand}"/>
                          </Grid>

                          <!-- Centered Key label -->
                          <TextBlock Text="Key"
                                     Margin="0,16,0,4"
                                     Foreground="{StaticResource SecondaryTextBrush}"
                                     FontWeight="SemiBold"
                                     HorizontalAlignment="Center"
                                     TextAlignment="Center"/>

                          <!-- New separator line -->
                          <Border Height="1"
                                  Margin="0,0,0,12"
                                  Background="{StaticResource SchedGridLineBrush}"
                                  HorizontalAlignment="Stretch"
                                  SnapsToDevicePixels="True"/>

                          <Border Background="{StaticResource BrushCoverage}" Style="{StaticResource KeyPillStyle}" Margin="0,0,0,8">
                            <TextBlock Text="Coverage" TextAlignment="Center" HorizontalAlignment="Stretch"/>
                          </Border>
                          <Border Background="{StaticResource BrushBreak}" Style="{StaticResource KeyPillStyle}" Margin="0,0,0,8">
                            <TextBlock Text="Break (10m + 5m buffer)" TextAlignment="Center" HorizontalAlignment="Stretch"/>
                          </Border>
                          <Border Background="{StaticResource BrushLunch}" Style="{StaticResource KeyPillStyle}" Margin="0,0,0,8">
                            <TextBlock Text="Lunch (30m)" TextAlignment="Center" HorizontalAlignment="Stretch"/>
                          </Border>
                          <Border Background="{StaticResource BrushIdle}" Style="{StaticResource KeyPillStyle}" Margin="0,0,0,8">
                            <TextBlock Text="Free" TextAlignment="Center" HorizontalAlignment="Stretch"/>
                          </Border>
                          <Border Background="{StaticResource BrushUnscheduled}" Style="{StaticResource KeyPillStyle}">
                            <TextBlock Text="Unscheduled" TextAlignment="Center" HorizontalAlignment="Stretch"/>
                          </Border>
                        </StackPanel>
                      </Grid>
                    </TabItem>

                    <TabItem Header="Print Preview">
                      <Grid Margin="16">
                        <Grid.RowDefinitions>
                          <RowDefinition Height="Auto"/>
                          <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>

                        <StackPanel Orientation="Horizontal" Grid.Row="0" Margin="{StaticResource ToolbarRowBottomMarginSmall}">
                          <ComboBox Width="200"
                                    ItemsSource="{Binding Schedule.SupportTabs}"
                                    DisplayMemberPath="SupportName"
                                    SelectedItem="{Binding PrintPreview.SelectedTab}" />
                          <Button Content="Print Selected" Style="{StaticResource IconButton}" Command="{Binding PrintPreview.PrintSelectedCommand}" Margin="{StaticResource ToolbarButtonMarginSmall}"
                                  IsEnabled="{Binding PrintPreview.SelectedTab, Converter={StaticResource NotNullToTrue}}"/>
                        </StackPanel>

                        <FlowDocumentScrollViewer x:Name="PrintPreviewViewer"
                                                  Grid.Row="1"
                                                  Document="{Binding PrintPreview.Document}"
                                                  Focusable="True"
                                                  PreviewMouseLeftButtonDown="ScheduleArea_PreviewMouseLeftButtonDown" />
                      </Grid>
                    </TabItem>
                  </TabControl>
                </ContentControl>
              </Grid>
            </TabItem>

            <!-- 2) Team Lineup -->
            <TabItem Header="Team Lineup">
              <Grid Margin="{StaticResource PageSectionMarginLarge}">
                <Grid.RowDefinitions>
                  <RowDefinition Height="Auto"/>
                  <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <!-- Team Lineup title (explicit baseline for the other two) -->
                <TextBlock Text="Team Lineup"
                           FontFamily="{StaticResource BodyFontFamily}"
                           FontSize="{StaticResource PageTitleFontSize}"
                           FontWeight="Normal"
                           Foreground="{StaticResource PrimaryTextBrush}"
                           HorizontalAlignment="Left"
                           Margin="{StaticResource TitleMarginBottomLarge}"/>

                <Grid Grid.Row="1">
                  <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                  </Grid.ColumnDefinitions>

                  <TabControl x:Name="SetupInnerTab" Grid.Column="0" Margin="{StaticResource RightColumnGapLarge}">
                    <TabItem Header="Classrooms and Teachers">
                      <Grid Margin="{StaticResource PageSectionMarginLarge}">
                        <Grid.ColumnDefinitions>
                          <ColumnDefinition Width="*" />
                          <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>

                        <ContentControl Grid.Column="0"
                                        Style="{StaticResource RoundedTableContainer}"
                                        Margin="{StaticResource NoMarginThickness}"
                                        VerticalContentAlignment="Stretch">
                          <DataGrid x:Name="TeachersGrid"
                                    ItemsSource="{Binding Setup.Teachers}"
                                    AutoGenerateColumns="False"
                                    CanUserAddRows="False"
                                    CanUserSortColumns="True"
                                    HeadersVisibility="Column"
                                    SelectionMode="Extended"
                                    SelectionUnit="FullRow"
                                    GridLinesVisibility="Horizontal"
                                    HorizontalGridLinesBrush="{StaticResource SchedGridLineBrush}"
                                    SnapsToDevicePixels="True"
                                    BorderThickness="{StaticResource NoBorderThickness}"
                                    Background="{StaticResource TransparentBrush}"
                                    ColumnHeaderStyle="{StaticResource RoundedDataGridColumnHeader}"
                                    beh:DataGridRowReorderBehavior.EnableRowReorder="True"
                                    ScrollViewer.VerticalScrollBarVisibility="Auto"
                                    ScrollViewer.HorizontalScrollBarVisibility="Auto"
                                    VerticalAlignment="Stretch"
                                    RowEditEnding="SetupDataGrid_RowEditEnding"
                                    CellEditEnding="SetupDataGrid_CellEditEnding">
                            <DataGrid.InputBindings>
                              <KeyBinding Key="Up" Modifiers="Control"
                                          Command="{Binding DataContext.Setup.MoveTeacherUpCommand, RelativeSource={RelativeSource AncestorType=Window}}"/>
                              <KeyBinding Key="Down" Modifiers="Control"
                                          Command="{Binding DataContext.Setup.MoveTeacherDownCommand, RelativeSource={RelativeSource AncestorType=Window}}"/>
                            </DataGrid.InputBindings>

                            <DataGrid.Resources>
                              <Style TargetType="{x:Type DataGridColumnHeadersPresenter}">
                                <Setter Property="Background" Value="{StaticResource TransparentBrush}"/>
                                <Setter Property="SnapsToDevicePixels" Value="True"/>
                                <Setter Property="ClipToBounds" Value="True"/>
                              </Style>
                            </DataGrid.Resources>

                            <DataGrid.Columns>
                              <DataGridTextColumn Header="Room Number"
                                                  Binding="{Binding RoomNumber}"
                                                  SortMemberPath="RoomNumber"
                                                  Width="*"
                                                  CellStyle="{StaticResource DefaultCellStyle}"
                                                  ElementStyle="{StaticResource DefaultTextElementStyle}"
                                                  EditingElementStyle="{StaticResource DefaultEditingElementStyle}"/>
                              <DataGridTextColumn Header="Teacher Name"
                                                  Binding="{Binding Name}"
                                                  SortMemberPath="Name"
                                                  Width="*"
                                                  CellStyle="{StaticResource DefaultCellStyle}"
                                                  ElementStyle="{StaticResource DefaultTextElementStyle}"
                                                  EditingElementStyle="{StaticResource DefaultEditingElementStyle}"/>
                              <DataGridTemplateColumn Header="Start Time"
                                                      SortMemberPath="Start"
                                                      Width="*"
                                                      CellStyle="{StaticResource DefaultCellStyle}">
                                <DataGridTemplateColumn.CellTemplate>
                                  <DataTemplate>
                                    <TextBlock Text="{Binding Start, Converter={StaticResource TimeSpanToStringConverter}}"
                                               Style="{StaticResource DefaultTextElementStyle}"/>
                                  </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                                <DataGridTemplateColumn.CellEditingTemplate>
                                  <DataTemplate>
                                    <ComboBox ItemsSource="{Binding DataContext.QuarterHours, RelativeSource={RelativeSource AncestorType=Window}}"
                                              SelectedItem="{Binding Start, Mode=TwoWay}"
                                              ItemTemplate="{StaticResource TimeItemTemplate}"
                                              MinWidth="120"
                                              Padding="{StaticResource CellEditorPadding}"
                                              Style="{StaticResource DefaultEditingComboBoxStyle}"/>
                                  </DataTemplate>
                                </DataGridTemplateColumn.CellEditingTemplate>
                              </DataGridTemplateColumn>

                              <DataGridTemplateColumn Header="End Time" SortMemberPath="End" Width="*"
                                                      CellStyle="{StaticResource LastColumnCellStyle}">
                                <DataGridTemplateColumn.CellTemplate>
                                  <DataTemplate>
                                    <TextBlock Text="{Binding End, Converter={StaticResource TimeSpanToStringConverter}}"
                                               Style="{StaticResource DefaultTextElementStyle}"/>
                                  </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                                <DataGridTemplateColumn.CellEditingTemplate>
                                  <DataTemplate>
                                    <ComboBox ItemsSource="{Binding DataContext.QuarterHours, RelativeSource={RelativeSource AncestorType=Window}}"
                                              SelectedItem="{Binding End, Mode=TwoWay}"
                                              ItemTemplate="{StaticResource TimeItemTemplate}"
                                              MinWidth="120"
                                              Padding="{StaticResource CellEditorPadding}"
                                              Style="{StaticResource DefaultEditingComboBoxStyle}"/>
                                  </DataTemplate>
                                </DataGridTemplateColumn.CellEditingTemplate>
                              </DataGridTemplateColumn>
                            </DataGrid.Columns>
                          </DataGrid>
                        </ContentControl>

                        <StackPanel Grid.Column="1"
                                    Orientation="Vertical"
                                    Margin="{StaticResource SidePanelLeftMargin}"
                                    VerticalAlignment="Top">
                          <Button Content="Add"
                                  Style="{StaticResource RoundedActionButton}"
                                  Margin="{StaticResource ActionButtonStackMargin}"
                                  Command="{Binding Setup.AddTeacherCommand}"/>
                          <Button Content="Remove"
                                  Style="{StaticResource RoundedActionButton}"
                                  Margin="{StaticResource ActionButtonStackMarginNone}"
                                  Command="{Binding Setup.RemoveTeacherCommand}"
                                  CommandParameter="{Binding SelectedItems, ElementName=TeachersGrid}"/>
                        </StackPanel>
                      </Grid>
                    </TabItem>

                    <TabItem Header="Support Staff">
                      <Grid Margin="{StaticResource PageSectionMarginLarge}">
                        <Grid.ColumnDefinitions>
                          <ColumnDefinition Width="*" />
                          <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>

                        <ContentControl Grid.Column="0"
                                        Style="{StaticResource RoundedTableContainer}"
                                        Margin="{StaticResource NoMarginThickness}"
                                        VerticalContentAlignment="Stretch">
                          <DataGrid x:Name="SupportsGrid"
                                    ItemsSource="{Binding Setup.Supports}"
                                    SelectedItem="{Binding Setup.SelectedSupport}"
                                    AutoGenerateColumns="False"
                                    CanUserAddRows="False"
                                    CanUserSortColumns="True"
                                    HeadersVisibility="Column"
                                    SelectionMode="Extended"
                                    SelectionUnit="FullRow"
                                    GridLinesVisibility="Horizontal"
                                    HorizontalGridLinesBrush="{StaticResource SchedGridLineBrush}"
                                    SnapsToDevicePixels="True"
                                    BorderThickness="{StaticResource NoBorderThickness}"
                                    Background="{StaticResource TransparentBrush}"
                                    ColumnHeaderStyle="{StaticResource RoundedDataGridColumnHeader}"
                                    beh:DataGridRowReorderBehavior.EnableRowReorder="True"
                                    ScrollViewer.VerticalScrollBarVisibility="Auto"
                                    ScrollViewer.HorizontalScrollBarVisibility="Auto"
                                    VerticalAlignment="Stretch"
                                    RowEditEnding="SetupDataGrid_RowEditEnding"
                                    CellEditEnding="SetupDataGrid_CellEditEnding">
                            <DataGrid.InputBindings>
                              <KeyBinding Key="Up" Modifiers="Control"
                                          Command="{Binding DataContext.Setup.MoveSupportUpCommand, RelativeSource={RelativeSource AncestorType=Window}}"/>
                              <KeyBinding Key="Down" Modifiers="Control"
                                          Command="{Binding DataContext.Setup.MoveSupportDownCommand, RelativeSource={RelativeSource AncestorType=Window}}"/>
                            </DataGrid.InputBindings>

                            <DataGrid.Columns>
                              <DataGridTextColumn Header="Support Staff"
                                                  Binding="{Binding Name}"
                                                  SortMemberPath="Name"
                                                  Width="*"
                                                  CellStyle="{StaticResource DefaultCellStyle}" />
                              <DataGridTemplateColumn Header="Start Time"
                                                      SortMemberPath="Start"
                                                      Width="*"
                                                      CellStyle="{StaticResource DefaultCellStyle}">
                                <DataGridTemplateColumn.CellTemplate>
                                  <DataTemplate>
                                    <TextBlock Text="{Binding Start, Converter={StaticResource TimeSpanToStringConverter}}"
                                               Style="{StaticResource DefaultTextElementStyle}"/>
                                  </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                                <DataGridTemplateColumn.CellEditingTemplate>
                                  <DataTemplate>
                                    <ComboBox ItemsSource="{Binding DataContext.QuarterHours, RelativeSource={RelativeSource AncestorType=Window}}"
                                              SelectedItem="{Binding Start, Mode=TwoWay}"
                                              ItemTemplate="{StaticResource TimeItemTemplate}"
                                              MinWidth="120"
                                              Padding="{StaticResource CellEditorPadding}"
                                              Style="{StaticResource DefaultEditingComboBoxStyle}"/>
                                  </DataTemplate>
                                </DataGridTemplateColumn.CellEditingTemplate>
                              </DataGridTemplateColumn>

                              <DataGridTemplateColumn Header="End Time"
                                                      SortMemberPath="End"
                                                      Width="*"
                                                      CellStyle="{StaticResource LastColumnCellStyle}">
                                <DataGridTemplateColumn.CellTemplate>
                                  <DataTemplate>
                                    <TextBlock Text="{Binding End, Converter={StaticResource TimeSpanToStringConverter}}"
                                               Style="{StaticResource DefaultTextElementStyle}"/>
                                  </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                                <DataGridTemplateColumn.CellEditingTemplate>
                                  <DataTemplate>
                                    <ComboBox ItemsSource="{Binding DataContext.QuarterHours, RelativeSource={RelativeSource AncestorType=Window}}"
                                              SelectedItem="{Binding End, Mode=TwoWay}"
                                              ItemTemplate="{StaticResource TimeItemTemplate}"
                                              MinWidth="120"
                                              Padding="{StaticResource CellEditorPadding}"/>
                                  </DataTemplate>
                                </DataGridTemplateColumn.CellEditingTemplate>
                              </DataGridTemplateColumn>
                            </DataGrid.Columns>
                          </DataGrid>
                        </ContentControl>

                        <StackPanel Grid.Column="1"
                                    Orientation="Vertical"
                                    Margin="{StaticResource SidePanelLeftMargin}"
                                    VerticalAlignment="Top">
                          <Button Content="Add"
                                  Style="{StaticResource RoundedActionButton}"
                                  Margin="{StaticResource ActionButtonStackMargin}"
                                  Command="{Binding Setup.AddSupportCommand}"/>
                          <Button Content="Remove"
                                  Style="{StaticResource RoundedActionButton}"
                                  Margin="{StaticResource ActionButtonStackMarginNone}"
                                  Command="{Binding Setup.RemoveSupportCommand}"
                                  CommandParameter="{Binding SelectedItems, ElementName=SupportsGrid}"/>
                        </StackPanel>
                      </Grid>
                    </TabItem>

                    <TabItem Header="Support Matchups">
                      <Grid Margin="{StaticResource PageSectionMarginLarge}">
                        <Grid.ColumnDefinitions>
                          <ColumnDefinition Width="*" />
                          <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>

                        <ContentControl Grid.Column="0"
                                        Style="{StaticResource RoundedTableContainer}"
                                        Margin="{StaticResource NoMarginThickness}"
                                        VerticalContentAlignment="Stretch">
                          <DataGrid x:Name="PrefsGrid"
                                    ItemsSource="{Binding Setup.Preferences}"
                                    SelectedItem="{Binding Setup.SelectedPreference}"
                                    AutoGenerateColumns="False"
                                    CanUserAddRows="False"
                                    CanUserSortColumns="True"
                                    HeadersVisibility="Column"
                                    SelectionMode="Extended"
                                    SelectionUnit="FullRow"
                                    GridLinesVisibility="Horizontal"
                                    HorizontalGridLinesBrush="{StaticResource SchedGridLineBrush}"
                                    SnapsToDevicePixels="True"
                                    BorderThickness="{StaticResource NoBorderThickness}"
                                    Background="{StaticResource TransparentBrush}"
                                    ColumnHeaderStyle="{StaticResource RoundedDataGridColumnHeader}"
                                    beh:DataGridRowReorderBehavior.EnableRowReorder="True"
                                    ScrollViewer.VerticalScrollBarVisibility="Auto"
                                    ScrollViewer.HorizontalScrollBarVisibility="Auto"
                                    VerticalAlignment="Stretch"
                                    RowEditEnding="SetupDataGrid_RowEditEnding"
                                    CellEditEnding="SetupDataGrid_CellEditEnding">
                            <DataGrid.InputBindings>
                              <KeyBinding Key="Up" Modifiers="Control"
                                          Command="{Binding DataContext.Setup.MovePreferenceUpCommand, RelativeSource={RelativeSource AncestorType=Window}}"/>
                              <KeyBinding Key="Down" Modifiers="Control"
                                          Command="{Binding DataContext.Setup.MovePreferenceDownCommand, RelativeSource={RelativeSource AncestorType=Window}}"/>
                            </DataGrid.InputBindings>

                            <DataGrid.Resources>
                              <Style TargetType="{x:Type DataGridColumnHeadersPresenter}">
                                <Setter Property="Background" Value="{StaticResource TransparentBrush}"/>
                                <Setter Property="SnapsToDevicePixels" Value="True"/>
                                <Setter Property="ClipToBounds" Value="True"/>
                              </Style>
                            </DataGrid.Resources>

                            <DataGrid.Columns>
                              <DataGridTextColumn Header="Room Number"
                                                  Binding="{Binding RoomNumber}"
                                                  SortMemberPath="RoomNumber"
                                                  Width="*"
                                                  CellStyle="{StaticResource DefaultCellStyle}"
                                                  ElementStyle="{StaticResource DefaultTextElementStyle}"
                                                  EditingElementStyle="{StaticResource DefaultEditingElementStyle}"/>
                              <DataGridTemplateColumn Header="Preferred Support Staff"
                                                      SortMemberPath="PreferredSupportName"
                                                      Width="*"
                                                      CellStyle="{StaticResource LastColumnCellStyle}">
                                <DataGridTemplateColumn.CellTemplate>
                                  <DataTemplate>
                                    <TextBlock Text="{Binding PreferredSupportName}" Margin="{StaticResource CellElementMargin}"/>
                                  </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                                <DataGridTemplateColumn.CellEditingTemplate>
                                  <DataTemplate>
                                    <ComboBox ItemsSource="{Binding DataContext.Setup.Supports, RelativeSource={RelativeSource AncestorType=Window}}"
                                              DisplayMemberPath="Name"
                                              SelectedValuePath="Name"
                                              SelectedValue="{Binding PreferredSupportName}"
                                              Margin="{StaticResource CellElementMargin}"
                                              Style="{StaticResource DefaultEditingComboBoxStyle}"/>
                                  </DataTemplate>
                                </DataGridTemplateColumn.CellEditingTemplate>
                              </DataGridTemplateColumn>
                            </DataGrid.Columns>
                          </DataGrid>
                        </ContentControl>

                        <StackPanel Grid.Column="1"
                                    Orientation="Vertical"
                                    Margin="{StaticResource SidePanelLeftMargin}"
                                    VerticalAlignment="Top">
                          <Button Content="Add"
                                  Style="{StaticResource RoundedActionButton}"
                                  Margin="{StaticResource ActionButtonStackMargin}"
                                  Command="{Binding Setup.AddPreferenceCommand}"/>
                          <Button Content="Remove"
                                  Style="{StaticResource RoundedActionButton}"
                                  Margin="{StaticResource ActionButtonStackMarginNone}"
                                  Command="{Binding Setup.RemovePreferenceCommand}"
                                  CommandParameter="{Binding SelectedItems, ElementName=PrefsGrid}"/>
                        </StackPanel>
                      </Grid>
                    </TabItem>
                  </TabControl>
                </Grid>
              </Grid>
            </TabItem>

            <!-- 3) Preferences -->
            <TabItem Header="Preferences">
              <Grid Margin="{StaticResource PageSectionMarginLarge}">
                <Grid.RowDefinitions>
                  <RowDefinition Height="Auto"/>
                  <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <!-- Header (kept consistent with other tabs) -->
                <TextBlock Grid.Row="0"
                           Text="Preferences"
                           FontFamily="{StaticResource BodyFontFamily}"
                           FontSize="{StaticResource PageTitleFontSize}"
                           FontWeight="Normal"
                           Foreground="{StaticResource PrimaryTextBrush}"
                           HorizontalAlignment="Left"
                           Margin="{StaticResource TitleMarginBottomLarge}"/>

                <!-- Match Team Lineup structure: rounded container + comfy inner padding -->
                <Grid Grid.Row="1">
                  <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                  </Grid.ColumnDefinitions>

                  <ContentControl Grid.Column="0"
                                  Style="{StaticResource RoundedTableContainer}"
                                  Margin="{StaticResource NoMarginThickness}"
                                  VerticalContentAlignment="Stretch">
                    <!-- Inner form layout spacing mirrors Team Lineup section spacing -->
                    <Grid Margin="{StaticResource PageSectionMarginLarge}">
                      <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                      </Grid.ColumnDefinitions>

                      <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                      </Grid.RowDefinitions>

                      <TextBlock Grid.Row="0" Grid.Column="0"
                                 Margin="{StaticResource FormLabelMargin}"
                                 VerticalAlignment="Center"
                                 Text="School Name"/>
                      <TextBox   Grid.Row="0" Grid.Column="1"
                                 Margin="{StaticResource FormFieldMarginBottom}"
                                 Text="{Binding Setup.SchoolName, UpdateSourceTrigger=PropertyChanged}"/>

                      <TextBlock Grid.Row="1" Grid.Column="0"
                                 Margin="{StaticResource FormLabelMargin}"
                                 VerticalAlignment="Top"
                                 Text="Address"/>
                      <TextBox   Grid.Row="1" Grid.Column="1"
                                 Margin="{StaticResource FormFieldMarginBottom}"
                                 Text="{Binding Setup.SchoolAddress, UpdateSourceTrigger=PropertyChanged}"
                                 AcceptsReturn="True"
                                 TextWrapping="Wrap"
                                 VerticalScrollBarVisibility="Auto"
                                 MinLines="4"
                                 MaxLines="4"/>

                      <TextBlock Grid.Row="2" Grid.Column="0"
                                 Margin="{StaticResource FormLabelMarginLastRow}"
                                 VerticalAlignment="Center"
                                 Text="Telephone"/>
                      <TextBox   Grid.Row="2" Grid.Column="1"
                                 Text="{Binding Setup.SchoolPhone, UpdateSourceTrigger=PropertyChanged}"/>

                      <Border Grid.Row="3" Grid.Column="0" Grid.ColumnSpan="2"
                              Height="1"
                              Background="{StaticResource SchedGridLineBrush}"
                              SnapsToDevicePixels="True"
                              Margin="24,24,24,24"
                              HorizontalAlignment="Stretch"/>

                      <TextBlock Grid.Row="4" Grid.Column="0"
                                 Margin="{StaticResource FormLabelMarginLastRow}"
                                 VerticalAlignment="Center"
                                 Text="Schedule Save Folder"/>

                      <Grid Grid.Row="4" Grid.Column="1" Margin="{StaticResource FormFieldMarginBottom}">
                        <Grid.ColumnDefinitions>
                          <ColumnDefinition Width="*"/>
                          <ColumnDefinition Width="Auto"/>
                          <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>

                        <TextBox Grid.Column="0"
                                 Text="{Binding Setup.SaveFolder, UpdateSourceTrigger=PropertyChanged}"
                                 VerticalAlignment="Center"/>

                        <Button Grid.Column="1"
                                Content="Browse…"
                                Style="{StaticResource RoundedActionButtonSmallRadius}"
                                Margin="8,0,8,0"
                                MinWidth="68"
                                HorizontalContentAlignment="Center"
                                VerticalContentAlignment="Center"
                                Command="{Binding Setup.BrowseSaveFolderCommand}"/>

                        <Button Grid.Column="2"
                                Content="Explore"
                                Style="{StaticResource RoundedActionButtonSmallRadius}"
                                MinWidth="68"
                                HorizontalContentAlignment="Center"
                                VerticalContentAlignment="Center"
                                Command="{Binding Setup.ExploreSaveFolderCommand}"/>
                      </Grid>
                    </Grid>
                  </ContentControl>
                </Grid>
              </Grid>
            </TabItem>

          </TabControl>
        </Grid>
      </Border>
    </DockPanel>

    <Grid x:Name="ResizeOverlay"
          Margin="3"
          Background="{x:Null}"
          IsHitTestVisible="True"
          ClipToBounds="True"
          Panel.ZIndex="10000"
          HorizontalAlignment="Stretch"
          VerticalAlignment="Stretch"
          SnapsToDevicePixels="True">

      <Thumb x:Name="ThumbLeft" Background="Transparent" Style="{StaticResource VisibleResizeThumbStyle}" IsHitTestVisible="True" Tag="Left" Width="8" HorizontalAlignment="Left" VerticalAlignment="Stretch" Cursor="SizeWE" PreviewMouseDown="ResizeThumb_PreviewMouseDown" DragDelta="ThumbLeft_DragDelta"/>
      <Thumb x:Name="ThumbRight" Background="Transparent" Style="{StaticResource VisibleResizeThumbStyle}" IsHitTestVisible="True" Tag="Right" Width="8" HorizontalAlignment="Right" VerticalAlignment="Stretch" Cursor="SizeWE" PreviewMouseDown="ResizeThumb_PreviewMouseDown" DragDelta="ThumbRight_DragDelta"/>
      <Thumb x:Name="ThumbTop" Background="Transparent" Style="{StaticResource VisibleResizeThumbStyle}" IsHitTestVisible="True" Tag="Top" Height="6" HorizontalAlignment="Stretch" VerticalAlignment="Top" Cursor="SizeNS" PreviewMouseDown="ResizeThumb_PreviewMouseDown" DragDelta="ThumbTop_DragDelta"/>
      <Thumb x:Name="ThumbBottom" Background="Transparent" Style="{StaticResource VisibleResizeThumbStyle}" IsHitTestVisible="True" Tag="Bottom" Height="6" HorizontalAlignment="Stretch" VerticalAlignment="Bottom" Cursor="SizeNS" PreviewMouseDown="ResizeThumb_PreviewMouseDown" DragDelta="ThumbBottom_DragDelta"/>
      <Thumb x:Name="ThumbTopLeft" Background="Transparent" Style="{StaticResource VisibleResizeThumbStyle}" IsHitTestVisible="True" Tag="TopLeft" Width="12" Height="12" HorizontalAlignment="Left" VerticalAlignment="Top" Cursor="SizeNWSE" PreviewMouseDown="ResizeThumb_PreviewMouseDown" DragDelta="ThumbTopLeft_DragDelta"/>
      <Thumb x:Name="ThumbTopRight" Background="Transparent" Style="{StaticResource VisibleResizeThumbStyle}" IsHitTestVisible="True" Tag="TopRight" Width="12" Height="12" HorizontalAlignment="Right" VerticalAlignment="Top" Cursor="SizeNESW" PreviewMouseDown="ResizeThumb_PreviewMouseDown" DragDelta="ThumbTopRight_DragDelta"/>
      <Thumb x:Name="ThumbBottomLeft" Background="Transparent" Style="{StaticResource VisibleResizeThumbStyle}" IsHitTestVisible="True" Tag="BottomLeft" Width="12" Height="12" HorizontalAlignment="Left" VerticalAlignment="Bottom" Cursor="SizeNESW" PreviewMouseDown="ResizeThumb_PreviewMouseDown" DragDelta="ThumbBottomLeft_DragDelta"/>
      <Thumb x:Name="ThumbBottomRight" Background="Transparent" Style="{StaticResource VisibleResizeThumbStyle}" IsHitTestVisible="True" Tag="BottomRight" Width="12" Height="12" HorizontalAlignment="Right" VerticalAlignment="Bottom" Cursor="SizeNWSE" PreviewMouseDown="ResizeThumb_PreviewMouseDown" DragDelta="ThumbBottomRight_DragDelta"/>
    </Grid>
  </Grid>
</Window>
